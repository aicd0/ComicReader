<base:BasePage
    x:Class="ComicReader.Views.Home.HomePage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:base="using:ComicReader.Common.PageBase"
    xmlns:controls="using:ComicReader.UserControls"
    xmlns:converters="using:ComicReader.Converters"
    xmlns:cw="using:CommunityToolkit.WinUI"
    xmlns:cwc="using:CommunityToolkit.WinUI.Controls"
    xmlns:cwm="using:CommunityToolkit.WinUI.Media"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:home="using:ComicReader.Views.Home"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:vm="using:ComicReader.ViewModels"
    Background="Transparent"
    mc:Ignorable="d">

    <Page.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/Styles/AdaptiveGridView.xaml" />
            </ResourceDictionary.MergedDictionaries>

            <cwm:AttachedCardShadow
                x:Key="CommonShadow"
                Opacity="0.1"
                Offset="0" />

            <Style x:Key="ComicItemContainerStyle" TargetType="GridViewItem">
                <Setter Property="Margin" Value="6" />
                <Setter Property="cw:Effects.Shadow" Value="{StaticResource CommonShadow}" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="GridViewItem">
                            <ListViewItemPresenter
                                x:Name="Root"
                                HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                                VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                                CheckBoxBrush="{ThemeResource GridViewItemCheckBoxBrush}"
                                CheckBrush="{ThemeResource GridViewItemCheckBrush}"
                                CheckMode="{ThemeResource GridViewItemCheckMode}"
                                ContentMargin="{TemplateBinding Padding}"
                                ContentTransitions="{TemplateBinding ContentTransitions}"
                                Control.IsTemplateFocusTarget="True"
                                CornerRadius="6"
                                DisabledOpacity="{ThemeResource ListViewItemDisabledThemeOpacity}"
                                DragBackground="{ThemeResource GridViewItemDragBackground}"
                                DragForeground="{ThemeResource GridViewItemDragForeground}"
                                DragOpacity="{ThemeResource ListViewItemDragThemeOpacity}"
                                FocusBorderBrush="{ThemeResource GridViewItemFocusBorderBrush}"
                                FocusSecondaryBorderBrush="{ThemeResource GridViewItemFocusSecondaryBorderBrush}"
                                FocusVisualMargin="{TemplateBinding FocusVisualMargin}"
                                PlaceholderBackground="{ThemeResource GridViewItemPlaceholderBackground}"
                                PressedBackground="{ThemeResource GridViewItemBackgroundPressed}"
                                ReorderHintOffset="{ThemeResource GridViewItemReorderHintThemeOffset}"
                                RevealBorderThickness="0"
                                SelectedBackground="{ThemeResource GridViewItemBackgroundSelected}"
                                SelectedForeground="{ThemeResource GridViewItemForegroundSelected}"
                                SelectedPointerOverBackground="{ThemeResource GridViewItemBackgroundSelectedPointerOver}"
                                SelectedPressedBackground="{ThemeResource GridViewItemBackgroundSelectedPressed}"
                                SelectionCheckMarkVisualEnabled="{ThemeResource GridViewItemSelectionCheckMarkVisualEnabled}" />
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <Style x:Key="ComicGroupHeaderContainerStyle" TargetType="GridViewHeaderItem">
                <Setter Property="FontFamily" Value="{ThemeResource ContentControlThemeFontFamily}" />
                <Setter Property="FontSize" Value="{ThemeResource GridViewHeaderItemThemeFontSize}" />
                <Setter Property="Background" Value="{ThemeResource GridViewHeaderItemBackground}" />
                <Setter Property="Margin" Value="0" />
                <Setter Property="Padding" Value="0" />
                <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                <Setter Property="VerticalContentAlignment" Value="Top" />
                <Setter Property="MinHeight" Value="0" />
                <Setter Property="UseSystemFocusVisuals" Value="{StaticResource UseSystemFocusVisuals}" />
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="GridViewHeaderItem">
                            <StackPanel
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="{TemplateBinding CornerRadius}">
                                <ContentPresenter
                                    x:Name="ContentPresenter"
                                    HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                                    VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"
                                    Content="{TemplateBinding Content}"
                                    ContentTemplate="{TemplateBinding ContentTemplate}"
                                    ContentTransitions="{TemplateBinding ContentTransitions}" />
                            </StackPanel>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>

            <CollectionViewSource
                x:Name="FlatComicItemSource"
                IsSourceGrouped="False"
                Source="{x:Bind FlatComicItems, Mode=OneWay}" />

            <CollectionViewSource
                x:Name="GroupedComicItemSource"
                IsSourceGrouped="True"
                ItemsPath="Items"
                Source="{x:Bind GroupedComicItems, Mode=OneWay}" />

            <converters:BooleanNegationConverter x:Key="BooleanNegationConverter" />
            <converters:BooleanToVisibilityNegationConverter x:Key="BooleanToVisibilityNegationConverter" />
        </ResourceDictionary>
    </Page.Resources>

    <Grid>
        <controls:AdaptiveGridView
            x:Name="ComicGridView"
            Margin="0,0,-1,0"
            Padding="35,10"
            ContainerContentChanging="OnAdaptiveGridViewContainerContentChanging"
            DesiredWidth="{StaticResource ComicItemVerticalDesiredWidth}"
            ItemContainerStyle="{StaticResource ComicItemContainerStyle}"
            ItemHeight="310"
            ScrollViewer.HorizontalScrollBarVisibility="Disabled"
            ScrollViewer.HorizontalScrollMode="Disabled"
            StretchContentForSingleRow="False"
            Style="{StaticResource HomePageAdaptiveGridViewStyle}">
            <controls:AdaptiveGridView.GroupStyle>
                <GroupStyle HeaderContainerStyle="{StaticResource ComicGroupHeaderContainerStyle}">
                    <GroupStyle.HeaderTemplate>
                        <DataTemplate>
                            <Grid Margin="6,0,8,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition Width="*" />
                                </Grid.ColumnDefinitions>
                                <Button
                                    Grid.Column="0"
                                    Width="30"
                                    Height="30"
                                    Padding="0"
                                    VerticalAlignment="Center">
                                    <FontIcon FontSize="12" Glyph="&#xE728;" />
                                </Button>
                                <TextBlock
                                    Grid.Column="1"
                                    Margin="8,0"
                                    VerticalAlignment="Center"
                                    FontSize="16"
                                    FontWeight="SemiBold"
                                    Text="{Binding GroupName}" />
                            </Grid>
                        </DataTemplate>
                    </GroupStyle.HeaderTemplate>
                </GroupStyle>
            </controls:AdaptiveGridView.GroupStyle>
            <controls:AdaptiveGridView.ItemTemplate>
                <DataTemplate x:DataType="vm:ComicItemViewModel">
                    <home:ComicItemVertical DataContext="{x:Bind}" />
                </DataTemplate>
            </controls:AdaptiveGridView.ItemTemplate>
            <controls:AdaptiveGridView.ItemsPanel>
                <ItemsPanelTemplate>
                    <ItemsWrapGrid AreStickyGroupHeadersEnabled="False" Orientation="Horizontal" />
                </ItemsPanelTemplate>
            </controls:AdaptiveGridView.ItemsPanel>
            <controls:AdaptiveGridView.Header>
                <StackPanel Orientation="Vertical">
                    <Grid Height="10" />
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <TextBlock
                            x:Uid="LibraryHeader"
                            Grid.Column="0"
                            Margin="6,0,0,0"
                            FontSize="22"
                            FontWeight="SemiBold"
                            Text="Library" />
                        <StackPanel
                            Grid.Column="1"
                            Margin="0,0,8,0"
                            VerticalAlignment="Bottom"
                            Orientation="Horizontal"
                            Spacing="5">
                            <DropDownButton x:Name="ViewTypeDropDownButton" />
                            <DropDownButton x:Name="SortByDropDownButton" />
                            <DropDownButton x:Name="GroupByDropDownButton" />
                            <DropDownButton x:Name="FilterPresetDropDownButton" />
                            <Button Click="EditFilterButton_Click" Content="Edit filter" />
                        </StackPanel>
                    </Grid>
                    <Grid Height="10" />
                    <Grid x:Name="SpLibraryEmpty" Padding="0,30">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <FontIcon
                            Grid.Column="0"
                            Margin="12,3,0,0"
                            VerticalAlignment="Top"
                            FontSize="14"
                            Glyph="&#xE946;" />
                        <RichTextBlock
                            Grid.Column="1"
                            Margin="6,0"
                            VerticalAlignment="Center"
                            IsTextSelectionEnabled="False">
                            <Paragraph>
                                <Run x:Uid="LibraryEmptyPart1" />
                                <Hyperlink Click="AddFolderHyperlink_Click">
                                    <Run x:Uid="AddFolderButton" />
                                </Hyperlink>
                                <Run x:Uid="LibraryEmptyPart2" />
                                <Hyperlink Click="RefreshHyperlink_Click">
                                    <Run x:Uid="HomePageRefreshButton" />
                                </Hyperlink>
                                <Run x:Uid="LibraryEmptyPart3" />
                            </Paragraph>
                        </RichTextBlock>
                    </Grid>
                </StackPanel>
            </controls:AdaptiveGridView.Header>
        </controls:AdaptiveGridView>
    </Grid>
</base:BasePage>
